<!DOCTYPE html>
<html>
<head>
	<title>RoboWARS!</title>
	<meta charset="utf-8">
    <link rel="stylesheet" href="./codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="./codemirror/theme/blackboard.css">
    <script src="./codemirror/lib/codemirror.js"></script>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
	<script type="text/javascript" src="scripts/interpreter.js"></script>
	<script type="text/javascript" src="scripts/robot.js"></script>
	<script type="text/javascript" src="scripts/action_stack.js"></script>

	<script src="/socket.io/socket.io.js"></script>
	<script>

  	actionStack = new ActionStack();

    Robot = robotFactory(actionStack);
    interpreter = new Interpreter();
      
	$(function() {

		var socket = io.connect('http://localhost/api/game');
		socket.on('connect', function () {
			socket.emit('join');

			// Called when a new game state is avaliable.
			socket.on('state', function (state) {
				interpreter.draw(state);
				socket.emit('actions',actionStack.flush());
				run();
			});
	    });
	});

	</script>
</head>
<body>
<canvas id="canvas" width="600" height="300"></canvas>
<button style="width:200px;height:90px" onclick="run()">Run !!</button>
<textarea id="code" name="code" width="300" height="300">

robot = new Robot("pedro");
robot.setPower(10);
robot.setAngle(20);
</textarea>


	<script>
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        mode:"javascript",
        matchBrackets: true, 
        theme:"blackboard"
      });
    

	function run()
	{
		eval(editor.getValue());
	}

    </script>
</body>
</html>
